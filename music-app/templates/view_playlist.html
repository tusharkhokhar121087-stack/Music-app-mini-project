{% extends 'base.html' %}
{% block content %}
<h2 id="allsongs">Playlist: {{ playlist_name }}</h2>

<button class="btn btn-danger mb-3" onclick="deletePlaylist('{{ playlist_id }}')">üóëÔ∏è Delete Playlist</button>

<div class="row">
    {% for song in songs %}
    <div class="col-md-4 mb-4">
        <div class="card bg-dark text-light">
            <img src="{{ song[3] }}" class="card-img-top img-fluid" style="object-fit: contain; max-height: 250px;">
            <div class="card-body">
                <h5 class="card-title">{{ song[1] }}</h5>
                <p class="card-text">{{ song[2] }}</p>
                <div class="custom-audio bg-secondary rounded p-2 d-flex align-items-center mt-auto">
                  <audio controls class="w-100 audio-dark">
                    <source src="{{ url_for('static', filename='songs/' ~ song[4]) }}" type="audio/mpeg">
                    Your browser does not support the audio element.
                  </audio>
                </div>
                <br><br>
                <button class="btn btn-danger btn-sm" onclick="removeFromPlaylist('{{ playlist_id }}', '{{ song[0] }}', this)">‚ùå Remove</button>
            </div>
        </div>
    </div>
    {% endfor %}
</div>
<style>
    .custom-audio {
  background: #1c1f23 !important;
  border-radius: 10px;
}
.audio-dark {
  filter: invert(100%) sepia(0%) saturate(0%) hue-rotate(180deg) brightness(90%) contrast(90%);
}
</style>
<script>
function removeFromPlaylist(playlistId, songId, btn) {
    if (!confirm("Are you sure you want to remove this song from the playlist?")) return;

    fetch(`/remove_from_playlist/${playlistId}/${songId}`, {
        method: 'POST'
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === 'success') {
            btn.closest('.col-md-4').remove();
        } else {
            alert("Error: " + data.message);
        }
    })
    .catch(err => {
        alert("Request failed");
        console.error(err);
    });
}

function deletePlaylist(playlistId) {
    if (!confirm("Are you sure you want to delete this playlist? This cannot be undone.")) return;

    fetch(`/delete_playlist/${playlistId}`, {
        method: 'POST'
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === 'success') {
            window.location.href = "/playlists"; 
        } else {
            alert("Error: " + data.message);
        }
    })
    .catch(err => {
        alert("Request failed");
        console.error(err);
    });
}
</script>
{% endblock %}
